# Repository Guidelines

このリポジトリは AtCoder Heuristic Contest の問題を解くためのソルバと付属ツールをまとめたものです。

## プロジェクト構成とモジュール
- Rust 製ソルバ本体は `src/` にあり、`main.rs` がルートファイルです。
  - `grid.rs`（盤面操作）、`random.rs`（高速な乱数生成）、`diagnostics.rs`（ログや計測）、`util.rs`（共通マクロ・トレイト）は初期ライブラリです。2次元グリッド問題の場合、 `Vec<Vec<T>>` ではなく `Map2d<T>` を使用してください。
  - 問題文の入力・出力はそれぞれ `problem.rs` の中に `Input`, `Output` という構造体としてまとめてください。 `Input` は `Input::read() -> Self` 関数を持ち、標準入力から入力を読み取って初期化できるようにします。 `Output` は `Display` トレイトを実装し、標準出力への書き出しが容易となるようにしてください。
  - `Input`, `Output` のメンバ変数名は必ずしも問題文と一致させる必要はありません。明瞭かつ簡潔なメンバ変数名とし、 `///` ドキュメントでそれぞれの変数名の意味を補足してください。
  - 新しい解法を追加するときは、 `src/solver/` 以下に新しいファイルを作り、 `main.rs` から呼び出す形としてください。 `src/solver.rs` や `src/solver` ディレクトリがない場合は新しく作成してください。 
  - ユーザーに読んでもらうことを意識し、適宜コメントを入れてください。
- AtCoder 配布ツールは `tools/` にまとまっていますが、基本的に触る必要はありません。`tools/` がビルドされていないことによるエラーが想定される場合、ユーザーに報告して対処してもらってください。
- ローカルで使う入力は `/pahcer/in/` 以下に置き、`single.py` や `pahcer_config.toml` が参照します。
- pahcer 自体の使い方は https://github.com/terry-u16/pahcer も参照してください。
- 巨大な実験データや `vis.html` の結果は `.gitignore` するか外部ストレージに保管し、`problem.html` は問題文（原文 HTML）を保管する参照専用ファイルとして扱ってください。
- 入力処理は `proconio` クレートに統一しており、原則として `input!` マクロを使ってください。
- pythonスクリプトの実行には `python` や `python3` ではなく `uv run` を使います。
- `./Cargo.toml` の内容はAtCoderのジャッジサーバーと合わせているので、クレートの追加をはじめとした編集を行ってはいけません。
- `uv` はローカル環境でしか使わないので、 `uv add` でライブラリを追加しても構いません。実験用のスクリプトなどは `./py` ディレクトリを作成し、その下に保存してください。

## 言語ポリシー
応答、PR 説明、ソースコード中のコメント、ドキュメントは原則として日本語で記述してください。AtCoder への提出内容と整合する必要がある場合のみ英語を併記し、翻訳漏れがないかレビュー時に確認します。

## ビルド・テスト・開発コマンド
- `uv run single.py -s <SEED>`: 入力ケース `<SEED>` で最適化を実行します。 `/pahcer/in/` 以下に置かれた指定されたケースのファイルを入力として読み込み、スコアを標準出力に出力します。 `out.txt` に解法コードの標準出力が、 `err.txt` に解法コードの標準エラー出力が、 `vis.html` にビジュアライズ結果が保存されます。
  - 実行例: `uv run single.py -s 0`
- `pahcer run`: `pahcer_config.toml` の設定に従って `/pahcer/in/` を入力群として読み込み、テストケースを並列実行します。
- `pahcer list`: 直近10回の `pahcer run` の結果を出力します。前回の結果から改善したかどうかの判断に使います。

### サンドボックス実行時の注意
`uv run single.py` や `pahcer run` は `target/` 以下に大量のファイルを書き込むため、サンドボックス環境だと `Invalid cross-device link` や `Permission denied` で失敗する可能性があります。これらのコマンドを実行する際は、必ずサンドボックス外（エスカレーションあり）の権限で動かしてください。

### スコア改善の確認
解法を改良したら `pahcer run` を実行し、平均スコアが改善したかを必ず確認してください。改善が確認できない場合は、 seed ごとの差分やログを残して原因を追います。

## コーディング規約と命名
Rust 2024 エディションの標準に従い、コミット前に `cargo fmt` を実行します。関数・変数は `snake_case`、定数は `SCREAMING_SNAKE_CASE`、型は `UpperCamelCase`。`grid.rs` はグリッド計算、`util.rs` は共通ルーチンと分離し、再利用関数には `///` ドキュメントや doctest を付記してください。`diagnostics.rs` のロギングは実行時間に影響するため feature flag や `cfg!(debug_assertions)` で切り替え可能にすると便利です。

## テスト指針
各モジュール直下で `#[cfg(test)]` を使った単体テストを置き、 `cargo test` を行ってください。回帰検証は seed を固定して `uv run single.py -s <SEED>` を実行し、得点を標準出力から読み取ってください。決定的でない場合は必ずしもスコアを一致させる必要はありませんが、大きなデグレが起きていないか確認してください。`single.py` が保存する `err.txt` は debug `println!` の確認にも使えるので、失敗ケースの再現手順と合わせて添付するとレビューがスムーズです。

## コミットと PR
履歴は `問題文追加` や `Initial commit` のような短文主体です。50 文字以内の命令形サマリ（日本語可）を推奨し、ソルバ調整・ツール更新・ドキュメントを分割してコミッしてください。
